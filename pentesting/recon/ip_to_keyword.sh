#!/bin/bash

# Check if keyword is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <keyword>"
    exit 1
fi

keyword=$(echo "$1" | tr '[:upper:]' '[:lower:]')  # Convert keyword to lowercase for case-insensitive comparison

# Check if IP list file is provided
if [ -z "$2" ]; then
    echo "Usage: $0 <keyword> <ip_list_file>"
    exit 1
fi

ip_list_file="$2"

# Check if the file exists
if [ ! -e "$ip_list_file" ]; then
    echo "Error: IP list file not found: $ip_list_file"
    exit 1
fi

# Output file for IPs where the keyword is not found
output_file="missing_keyword_ips.txt"

# Ensure the output file is empty
> "$output_file"

while IFS= read -r ip; do
    whois_output=$(whois "$ip" | tr '[:upper:]' '[:lower:]')
    nslookup_output=$(nslookup "$ip" 2>/dev/null | tr '[:upper:]' '[:lower:]')

    # Check for the keyword in both whois and nslookup output
    if ! echo "$whois_output" | grep -q "$keyword" && ! echo "$nslookup_output" | grep -q "$keyword"; then
        echo "$ip" >> "$output_file"
        echo "Keyword not found for $ip. Appending to $output_file."
    fi
done < "$ip_list_file"

echo "Script execution completed."
