#!/bin/bash

# Check if two keywords are provided
if [ -z "$1" ] || [ -z "$2" ]; then
    echo "Usage: $0 <keyword1> <keyword2>"
    exit 1
fi

keyword1=$(echo "$1" | tr '[:upper:]' '[:lower:]')  # Convert keyword1 to lowercase for case-insensitive comparison
keyword2=$(echo "$2" | tr '[:upper:]' '[:lower:]')  # Convert keyword2 to lowercase for case-insensitive comparison

# Check if IP list file is provided
if [ -z "$3" ]; then
    echo "Usage: $0 <keyword1> <keyword2> <ip_list_file>"
    exit 1
fi

ip_list_file="$3"

# Check if the file exists
if [ ! -e "$ip_list_file" ]; then
    echo "Error: IP list file not found: $ip_list_file"
    exit 1
fi

# Output file for IPs where neither keyword is found
output_file="missing_keywords_ips.txt"

# Ensure the output file is empty
> "$output_file"

while IFS= read -r ip; do
    whois_output=$(whois "$ip" | tr '[:upper:]' '[:lower:]')
    nslookup_output=$(nslookup "$ip" 2>/dev/null | tr '[:upper:]' '[:lower:]')

    # Check for both keywords in both whois and nslookup output
    if ! (echo "$whois_output" | grep -q "$keyword1" || echo "$whois_output" | grep -q "$keyword2") &&
       ! (echo "$nslookup_output" | grep -q "$keyword1" || echo "$nslookup_output" | grep -q "$keyword2"); then
        echo "$ip" >> "$output_file"
        echo "Keywords not found for $ip. Appending to $output_file."
    fi
done < "$ip_list_file"

echo "Script execution completed."
