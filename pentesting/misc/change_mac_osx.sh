#!/bin/bash

# Help menu
display_help() {
    echo "Usage: $0 <interface>"
    echo "  -h, --help   Display this help menu"
    exit 0
}

# Check for root privileges
if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root."
    exit 1
fi

# Check for correct usage and help flag
if [[ $# -ne 1 ]]; then
    display_help
fi

if [[ $1 == "-h" || $1 == "--help" ]]; then
    display_help
fi

interface="$1"

# Check if the interface exists
if ! ifconfig "$interface" > /dev/null 2>&1; then
    echo "Interface '$interface' not found."
    exit 1
fi

# Check if .original_mac file exists, if not, create it
original_mac_file=".original_mac"
if [[ ! -f "$original_mac_file" ]]; then
    current_mac=$(ifconfig "$interface" | awk '/ether/{print $2}')
    echo "$current_mac" > "$original_mac_file"
fi

# Generate a random MAC address
random_mac=$(openssl rand -hex 6 | sed 's/\(..\)/\1:/g; s/.$//')

# Disable the network interface
ifconfig "$interface" down

# Change the MAC address
ifconfig "$interface" ether "$random_mac"

# Enable the network interface
ifconfig "$interface" up

# Flush ARP cache (might require administrative privileges)
arp -a -d

echo "MAC address of $interface changed to $random_mac"
